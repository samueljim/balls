(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,94108,e=>{"use strict";let t=e.i(17141).default.env.NEXT_PUBLIC_API_BASE??"https://api.worms.bne.sh";async function a(e){if(!(e.headers.get("content-type")??"").includes("application/json")){let t=await e.text();if(t.trimStart().startsWith("<!"))throw Error("Backend returned HTML instead of JSON. Set NEXT_PUBLIC_API_BASE to your Worker URL (e.g. http://localhost:8787).");throw Error(t||e.statusText||"Request failed")}return e.json()}e.s(["API_BASE",0,t,"apiJson",()=>a])},12024,e=>{"use strict";var t=e.i(17141),a=e.i(44440);function r(e){let[t,r]=(0,a.useState)(WebSocket.CLOSED),[n,s]=(0,a.useState)(null),l=(0,a.useRef)(null),i=(0,a.useCallback)(e=>{let t=l.current;t?.readyState===WebSocket.OPEN&&t.send("string"==typeof e?e:JSON.stringify(e))},[]);return(0,a.useEffect)(()=>{if(!e)return;let t=new WebSocket(e);return l.current=t,t.onopen=()=>r(WebSocket.OPEN),t.onclose=()=>{r(WebSocket.CLOSED),l.current=null},t.onmessage=e=>{try{s(JSON.parse(e.data))}catch{s(e.data)}},()=>{t.close(),l.current=null}},[e]),{readyState:t,lastMessage:n,send:i}}function n(e){let a=(t.default.env.NEXT_PUBLIC_WS_BASE??t.default.env.NEXT_PUBLIC_API_BASE??"https://api.worms.bne.sh").replace(/^http/,"ws");return`${a}${e}`}e.s(["getWsUrl",()=>n,"useWebSocket",()=>r])},59585,e=>{"use strict";var t=e.i(87433),a=e.i(62924),r=e.i(44440),n=e.i(70065),s=e.i(94108),l=e.i(12024);function i({gameId:e,playerId:a,playerOrder:n}){let i=(0,r.useRef)(null),[c,o]=(0,r.useState)([]),[d,u]=(0,r.useState)(0),[f,x]=(0,r.useState)(!1),m=(0,r.useRef)(null),h=`/game/${e}?playerId=${encodeURIComponent(a)}`,{readyState:p,lastMessage:g,send:b}=(0,l.useWebSocket)((0,l.getWsUrl)(h)),y=(0,r.useRef)(0);if(0===y.current){let t=0;for(let a=0;a<e.length;a++)t=(t<<5)-t+e.charCodeAt(a);y.current=Math.abs(t>>>0)}let N=y.current,S=(0,r.useRef)(!1);(0,r.useEffect)(()=>{p===WebSocket.OPEN&&!S.current&&0!==n.length&&N&&(S.current=!0,fetch(`${s.API_BASE}/game/${e}/init`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({playerOrder:n,rngSeed:N,terrainId:0})}).then(e=>e.ok&&x(!0)).catch(console.error))},[p,e,n,N]),(0,r.useEffect)(()=>{if(g&&"object"==typeof g&&("input"===g.type&&g.input&&(o(e=>[...e,g.input]),m.current?.apply_input(g.input)),"turn_advanced"===g.type&&void 0!==g.turnIndex&&u(g.turnIndex),"state"===g.type&&g.state)){if(g.state.inputLog){o(g.state.inputLog);let e=m.current;e&&g.state.inputLog.forEach(t=>e.apply_input(t))}void 0!==g.state.currentTurnIndex&&u(g.state.currentTurnIndex)}},[g]);let j=(0,r.useCallback)(e=>{b({type:"input",input:e})},[b]),v=(0,r.useRef)(!1);(0,r.useEffect)(()=>{let e=!1;return(async()=>{try{let t=await import("/wasm/game_core.js");await t.default();let{Game:a}=t,r=new a,s=[];for(let e=0;e<n.length;e++)s.push(Math.floor(800*(e+1)/(n.length+1)),320);if(r.init_round(N,0,s),e)return;m.current=r}catch(e){console.error("WASM load failed, using placeholder:",e),m.current=null}})(),()=>{e=!0}},[n.length]),(0,r.useEffect)(()=>{let e=i.current;if(!e||!m.current)return;let t=e.getContext("2d");if(!t)return;let a=m.current.terrain_width(),r=m.current.terrain_height();e.width=a,e.height=r;let n=()=>{let e=m.current;if(!e)return;let n=e.get_terrain_buffer(),s=e.get_state_json(),l={};try{l=JSON.parse(s)}catch{}if(t.fillStyle="#1a472a",t.fillRect(0,0,a,r),n.length===a*r){let e=t.createImageData(a,r);for(let t=0;t<n.length;t++){let a=n[t];e.data[4*t]=a?139:34,e.data[4*t+1]=a?90:139,e.data[4*t+2]=a?43:69,e.data[4*t+3]=255}t.putImageData(e,0,0)}(l.worms??[]).forEach((e,a)=>{t.fillStyle=a===d?"#fbbf24":"#22c55e",t.beginPath(),t.arc(e.x,e.y,10,0,2*Math.PI),t.fill(),t.fillStyle="#fff",t.font="10px sans-serif",t.fillText(String(e.health),e.x-4,e.y-12)})},s=setInterval(()=>{if(m.current){m.current.tick();let e=m.current.get_state_json();try{let t=JSON.parse(e);"TurnEnd"===t.phase&&v.current&&(v.current=!1,b({type:"end_turn"}))}catch(e){}n()}},50);return n(),()=>clearInterval(s)},[d,c,b]);let w=n.findIndex(e=>e.playerId===a)===d&&!n[d]?.isBot,[_,E]=(0,r.useState)(45),[I,k]=(0,r.useState)(70),[P,O]=(0,r.useState)("Bazooka");return(0,t.jsxs)("div",{className:"min-h-screen flex flex-col bg-gradient-to-b from-[#0d1f0d] via-[#0a0a0a] to-[#1a0f0a]",children:[(0,t.jsxs)("div",{className:"p-3 flex flex-wrap items-center justify-between gap-3 border-b-2 border-emerald-800/60 bg-stone-900/80",children:[(0,t.jsxs)("span",{className:"font-display text-sm text-emerald-400/90 tracking-wider",children:["TURN: ",n[d]?.name??"—"]}),w&&(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"font-display text-xs text-emerald-600/90",children:"WEAPON"}),(0,t.jsxs)("select",{className:"rounded-lg border-2 border-stone-600 bg-stone-950 px-2 py-1.5 text-sm text-stone-100 font-display",value:P,onChange:e=>O(e.target.value),children:[(0,t.jsx)("option",{value:"Bazooka",children:"Bazooka"}),(0,t.jsx)("option",{value:"Grenade",children:"Grenade"})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"font-display text-xs text-emerald-600/90",children:"ANGLE"}),(0,t.jsx)("input",{type:"range",min:"0",max:"180",value:_,onChange:e=>E(Number(e.target.value)),className:"w-24 accent-emerald-500"}),(0,t.jsxs)("span",{className:"font-display text-xs w-8 text-stone-300",children:[_,"°"]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"font-display text-xs text-emerald-600/90",children:"POWER"}),(0,t.jsx)("input",{type:"range",min:"10",max:"100",value:I,onChange:e=>k(Number(e.target.value)),className:"w-24 accent-emerald-500"}),(0,t.jsxs)("span",{className:"font-display text-xs w-8 text-stone-300",children:[I,"%"]})]}),(0,t.jsx)("button",{className:"font-display px-4 py-2 rounded-xl bg-gradient-to-b from-emerald-500 to-emerald-700 hover:from-emerald-400 hover:to-emerald-600 text-emerald-950 border-2 border-emerald-400/50 text-sm shadow-lg hover:scale-105 active:scale-95 transition-transform",onClick:()=>{v.current=!0,j(JSON.stringify({Fire:{weapon:P,angle_deg:_,power_percent:I}}))},children:"FIRE"}),(0,t.jsx)("button",{className:"font-display px-4 py-2 rounded-xl border-2 border-stone-500 bg-stone-800 text-stone-100 text-sm hover:bg-stone-700 transition-colors",onClick:()=>b({type:"end_turn"}),children:"END TURN"})]})]}),(0,t.jsx)("canvas",{ref:i,className:"flex-1 w-full",style:{imageRendering:"pixelated"}})]})}function c({overrideId:e,overrideSearch:s}={}){let l,o=(0,a.useParams)(),d=(0,a.useSearchParams)(),u=void 0!==s?(l=new URLSearchParams(s||window.location.search),{get:e=>l.get(e)??""}):d,f=e??o.id??"",x=u.get("playerId")??"",[m,h]=(0,r.useState)([]);return((0,r.useEffect)(()=>{if(f)try{let e=sessionStorage.getItem(`worms:${f}`);e&&h(JSON.parse(e))}catch(e){}},[f]),f)?0===m.length?(0,t.jsxs)("main",{className:"min-h-screen relative flex flex-col items-center justify-center overflow-hidden bg-gradient-to-b from-[#0d1f0d] via-[#0a0a0a] to-[#1a0f0a]",children:[(0,t.jsxs)("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[(0,t.jsx)("div",{className:"absolute -bottom-20 left-1/4 w-72 h-72 rounded-full bg-[#1a2e1a]/40 blur-3xl"}),(0,t.jsx)("div",{className:"absolute bottom-0 right-1/3 w-96 h-48 rounded-full bg-[#2d1a0a]/30 blur-3xl"})]}),(0,t.jsxs)("div",{className:"relative z-10 text-center",children:[(0,t.jsx)("h1",{className:"font-display text-4xl sm:text-5xl mb-4",style:{color:"#22c55e",textShadow:"3px 3px 0 #166534"},children:"LOADING GAME…"}),(0,t.jsx)("p",{className:"text-stone-500 text-sm",children:(0,t.jsx)(n.default,{href:"/",className:"text-emerald-500 hover:text-emerald-400 underline",children:"Back home"})})]})]}):(0,t.jsx)(i,{gameId:f,playerId:x,playerOrder:m}):(0,t.jsx)("main",{className:"min-h-screen flex items-center justify-center bg-[#0d1f0d]",children:(0,t.jsx)("p",{className:"text-stone-400",children:"Missing game id"})})}function o({overrideId:e,overrideSearch:a}={}){return(0,t.jsx)(r.Suspense,{fallback:(0,t.jsx)("main",{className:"min-h-screen flex items-center justify-center bg-gradient-to-b from-[#0d1f0d] via-[#0a0a0a] to-[#1a0f0a]",children:(0,t.jsx)("h1",{className:"font-display text-3xl text-emerald-500",children:"LOADING…"})}),children:(0,t.jsx)(c,{overrideId:e,overrideSearch:a})})}e.s(["default",()=>o],59585)},76387,e=>{e.n(e.i(59585))}]);